name: Cleanup Old Docker Images

on:
  schedule:
    - cron: "0 3 * * *"   # Runs daily at 03:00 UTC
  workflow_dispatch:      # Allow manual trigger

permissions:
  packages: write
  contents: read

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Delete old SHA-only images
        uses: actions/delete-package-versions@v4
        with:
          owner: your-github-org-or-username
          package-name: your-image-name   # e.g. "myapp"
          package-type: container

          # Keep the newest 20 SHA images
          min-versions-to-keep: 20

          # Match SHA-only tags (40 hex chars)
          delete-tags: |
            ^[0-9a-f]{40}$

          # Do NOT delete tags like "latest", "v1.2.3", etc.
          ignore-tags: |
            latest
            ^v[0-9]+\.[0-9]+\.[0-9]+$
